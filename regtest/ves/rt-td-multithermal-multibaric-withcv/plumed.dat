# vim:ft=plumed
# Read energy and order parameter
energy: READ FILE=COLVAR-READ VALUES=energy IGNORE_FORCES
vol: READ FILE=COLVAR-READ VALUES=vol IGNORE_FORCES
op: READ FILE=COLVAR-READ VALUES=op.morethan IGNORE_FORCES

# Construct a bias potential using VES
# The hyperparameters used here might not reflect correct values for simulations
# Please refer to the original papers for suitable hyperparameters

# Basis functions
bf1: BF_LEGENDRE ORDER=8 MINIMUM=-26500 MAXIMUM=-23500
bf2: BF_LEGENDRE ORDER=8 MINIMUM=8.0 MAXIMUM=11.5
bf3: BF_LEGENDRE ORDER=8 MINIMUM=0.0 MAXIMUM=250.0

# Target distribution
TD_MULTITHERMAL_MULTIBARIC ...
 LABEL=td_multitp
 MIN_PRESSURE=0.06022140857
 MAX_PRESSURE=602.2140857
 MIN_TEMP=350.0
 MAX_TEMP=450.0
 PRESSURE=301.10704285
 SIGMA=250.0,0.1,10.0
 THRESHOLD=15
 STEPS_TEMP=20
 STEPS_PRESSURE=20
... TD_MULTITHERMAL_MULTIBARIC

# Expansion
VES_LINEAR_EXPANSION ...
 ARG=energy,vol,op.morethan
 BASIS_FUNCTIONS=bf1,bf2,bf3
 TEMP=400.0
 GRID_BINS=20,20,20
 TARGET_DISTRIBUTION=td_multitp
 LABEL=b1
... VES_LINEAR_EXPANSION

# Optimization algorithm
OPT_AVERAGED_SGD ...
  BIAS=b1
  STRIDE=1
  LABEL=o1
  STEPSIZE=0.1
  FES_OUTPUT=10000
  BIAS_OUTPUT=10000
  TARGETDIST_OUTPUT=10000
  COEFFS_OUTPUT=5000
  TARGETDIST_STRIDE=5000
  COEFFS_FMT=%12.6f
... OPT_AVERAGED_SGD

PRINT ARG=* FILE=COLVAR STRIDE=10

